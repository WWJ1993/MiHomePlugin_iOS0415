{"version":3,"sources":["../src/AnimatedData.js"],"names":[],"mappings":"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","file":"AnimatedData.js","sourcesContent":["const isAnimated = require(\"./isAnimated\");\n\n// At the moment, need to dup some things from RN Animated\n\nclass Animated {\n  __attach () {}\n  __detach () {}\n  __getValue () {}\n  __getAnimatedValue () { return this.__getValue(); }\n  __addChild () {}\n  __removeChild () {}\n  __getChildren () { return []; }\n}\n\nclass AnimatedWithChildren extends Animated {\n  constructor () {\n    super();\n    this._children = [];\n  }\n  __addChild (child) {\n    if (this._children.length === 0) {\n      this.__attach();\n    }\n    this._children.push(child);\n  }\n  __removeChild (child) {\n    var index = this._children.indexOf(child);\n    if (index === -1) {\n      console.warn(\"Trying to remove a child that doesn't exist\");\n      return;\n    }\n    this._children.splice(index, 1);\n    if (this._children.length === 0) {\n      this.__detach();\n    }\n  }\n  __getChildren () {\n    return this._children;\n  }\n}\n\n// Animated over the GL Data uniforms object\nclass AnimatedUniforms extends AnimatedWithChildren {\n  constructor (uniforms) {\n    super();\n    this._uniforms = uniforms;\n    this.__attach();\n  }\n\n  __getValue() {\n    const u = {};\n    const uniforms = this._uniforms;\n    for (let key in uniforms) {\n      let value = uniforms[key];\n      if (value instanceof Array) {\n        let arr = [];\n        for (let i = 0; i < value.length; i++) {\n          let v = value[i];\n          arr[i] = isAnimated(v) ? v.__getValue() : v;\n        }\n        u[key] = arr;\n      }\n      else if (isAnimated(value)) {\n        u[key] = value.__getValue();\n      }\n      else {\n        u[key] = value;\n      }\n    }\n    return u;\n  }\n\n  __attach() {\n    const uniforms = this._uniforms;\n    for (let key in uniforms) {\n      let value = uniforms[key];\n      if (value instanceof Array) {\n        for (let i = 0; i < value.length; i++) {\n          let v = value[i];\n          if (isAnimated(v)) {\n            v.__addChild(this);\n          }\n        }\n      }\n      else if (isAnimated(value)) {\n        value.__addChild(this);\n      }\n    }\n  }\n\n  __detach() {\n    const uniforms = this._uniforms;\n    for (let key in uniforms) {\n      let value = uniforms[key];\n      if (value instanceof Array) {\n        for (let i = 0; i < value.length; i++) {\n          let v = value[i];\n          if (isAnimated(v)) {\n            v.__removeChild(this);\n          }\n        }\n      }\n      else if (isAnimated(value)) {\n        value.__removeChild(this);\n      }\n    }\n  }\n}\n\n// Animated over a GL Data\nclass AnimatedData extends AnimatedWithChildren {\n  constructor (data, callback) {\n    super();\n    this._data = {\n      ...data,\n      contextChildren: data.contextChildren.map(d => new AnimatedData(d)),\n      children: data.children.map(d => new AnimatedData(d)),\n      uniforms: new AnimatedUniforms(data.uniforms)\n    };\n    if (callback) this.update = callback;\n    this.__attach();\n  }\n\n  __getValue() {\n    const { ...data, contextChildren, width, height, children, uniforms } = this._data;\n    data.width = isAnimated(width) ? width.__getValue() : width;\n    data.height = isAnimated(height) ? height.__getValue() : height;\n    data.contextChildren = contextChildren.map(c => c.__getValue());\n    data.children = children.map(c => c.__getValue());\n    data.uniforms = uniforms.__getValue();\n    return data;\n  }\n\n  __attach() {\n    const { contextChildren, children, uniforms, width, height } = this._data;\n    if (isAnimated(width)) width.__addChild(this);\n    if (isAnimated(height)) height.__addChild(this);\n    contextChildren.forEach(c => c.__addChild(this));\n    children.forEach(c => c.__addChild(this));\n    uniforms.__addChild(this);\n  }\n\n  __detach() {\n    const { contextChildren, children, uniforms, width, height } = this._data;\n    if (isAnimated(width)) width.__removeChild(this);\n    if (isAnimated(height)) height.__removeChild(this);\n    contextChildren.forEach(c => c.__removeChild(this));\n    children.forEach(c => c.__removeChild(this));\n    uniforms.__removeChild(this);\n  }\n}\n\nmodule.exports = AnimatedData;\n"]}